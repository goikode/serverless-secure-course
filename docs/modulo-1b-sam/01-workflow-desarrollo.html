<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow SAM: Build, Deploy, Test, Update - Goikode Serverless Secure Course</title>
    <link rel="stylesheet" href="../styles/goikode-docs.css">
</head>
<body>
    <!-- Header with logo and student prefix -->
    <header class="doc-header">
        <div class="doc-header-left">
            <a href="../index.html" class="logo-link">
                <img src="../assets/brand/logo.svg" alt="Goikode" class="doc-logo" onerror="this.src='../assets/brand/logo.png'">
            </a>
            <h1 class="doc-title">Workflow SAM: Build, Deploy, Test, Update</h1>
        </div>
        <div class="doc-header-right">
            <div class="student-prefix-display">
                <span class="student-prefix-label">Tu prefijo:</span>
                <span id="header-student-prefix">-</span>
            </div>
            <button id="change-prefix-btn">Cambiar Prefijo</button>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Índice del Curso</h2>
            <button class="sidebar-toggle" id="sidebar-toggle">✕</button>
        </div>
        <div class="sidebar-content" id="sidebar-content">
            <div class="sidebar-loading">Cargando índice...</div>
        </div>
    </aside>

    <!-- Toggle button for mobile -->
    <button class="sidebar-open-btn" id="sidebar-open-btn">☰</button>

    <!-- Main content container -->
    <div class="doc-container with-sidebar">
        <div class="doc-content">
            <h1 id="workflow-sam-build-deploy-test-update">Workflow SAM: Build, Deploy, Test, Update</h1>
<h2 id="el-ciclo-de-desarrollo-completo">El Ciclo de Desarrollo Completo</h2>
<hr />
<h2 id="objetivos-de-aprendizaje">🎯 Objetivos de Aprendizaje</h2>
<p>Al finalizar esta sección, serás capaz de:</p>
<ul>
<li>✅ Usar <code>sam init</code> para crear proyectos desde cero</li>
<li>✅ Ejecutar <code>sam build</code> para empaquetar código</li>
<li>✅ Desplegar con <code>sam deploy</code> (guiado y automático)</li>
<li>✅ Probar localmente con <code>sam local invoke</code> y <code>sam local start-api</code></li>
<li>✅ Ver logs en tiempo real con <code>sam logs</code></li>
<li>✅ Actualizar aplicaciones existentes</li>
<li>✅ Eliminar stacks con <code>sam delete</code></li>
</ul>
<hr />
<h2 id="el-ciclo-de-desarrollo-sam">🔄 El Ciclo de Desarrollo SAM</h2>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────┐
│                                                     │
│  1. INIT (opcional)                                 │
│     sam init                                        │
│     └─&gt; Crear estructura de proyecto               │
│                                                     │
│  2. DEVELOP                                         │
│     ├─&gt; Escribir código (Lambda handlers)          │
│     ├─&gt; Escribir template.yaml (infraestructura)   │
│     └─&gt; Escribir tests                             │
│                                                     │
│  3. BUILD                                           │
│     sam build                                       │
│     └─&gt; Empaquetar código + dependencias           │
│                                                     │
│  4. TEST LOCAL (opcional)                           │
│     ├─&gt; sam local invoke      (probar Lambda)      │
│     └─&gt; sam local start-api   (probar API)         │
│                                                     │
│  5. DEPLOY                                          │
│     sam deploy                                      │
│     └─&gt; Crear/actualizar recursos en AWS           │
│                                                     │
│  6. MONITOR                                         │
│     sam logs --tail                                 │
│     └─&gt; Ver logs en tiempo real                    │
│                                                     │
│  7. UPDATE (repetir desde paso 2)                  │
│     └─&gt; Modificar código/template → Build → Deploy │
│                                                     │
└─────────────────────────────────────────────────────┘
</code></pre></div>

<hr />
<h2 id="1-paso-1-init-crear-proyecto-opcional">1️⃣ Paso 1: INIT - Crear Proyecto (Opcional)</h2>
<p>SAM puede generar una estructura de proyecto completa con ejemplos.</p>
<h3 id="opcion-a-usar-sam-init-proyecto-desde-cero">Opción A: Usar <code>sam init</code> (Proyecto desde cero)</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>init
</code></pre></div>

<p>Esto inicia un wizard interactivo:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Which</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="nx">would</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">use</span><span class="p">?</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">AWS</span><span class="w"> </span><span class="nx">Quick</span><span class="w"> </span><span class="nx">Start</span><span class="w"> </span><span class="nx">Templates</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Custom</span><span class="w"> </span><span class="nx">Template</span><span class="w"> </span><span class="nx">Location</span>
<span class="nx">Choice</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>

<span class="nx">Choose</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">AWS</span><span class="w"> </span><span class="nx">Quick</span><span class="w"> </span><span class="nx">Start</span><span class="w"> </span><span class="nx">application</span><span class="w"> </span><span class="nx">template</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Hello</span><span class="w"> </span><span class="nx">World</span><span class="w"> </span><span class="nx">Example</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">step</span><span class="w"> </span><span class="nx">workflow</span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Serverless</span><span class="w"> </span><span class="nx">API</span>
<span class="w">  </span><span class="o">...</span>
<span class="nx">Template</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>

<span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">most</span><span class="w"> </span><span class="nx">popular</span><span class="w"> </span><span class="nx">runtime</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="kn">package</span><span class="w"> </span><span class="k">type</span><span class="p">?</span><span class="w"> </span><span class="p">(</span><span class="nx">Python</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">zip</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nx">y</span><span class="o">/</span><span class="nx">N</span><span class="p">]:</span><span class="w"> </span><span class="nx">n</span>

<span class="nx">Which</span><span class="w"> </span><span class="nx">runtime</span><span class="w"> </span><span class="nx">would</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">use</span><span class="p">?</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">nodejs20</span><span class="p">.</span><span class="nx">x</span>
<span class="w">  </span><span class="o">...</span>
<span class="nx">Runtime</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>

<span class="nx">Would</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="nx">X</span><span class="o">-</span><span class="nx">Ray</span><span class="w"> </span><span class="nx">tracing</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)?</span><span class="w"> </span><span class="p">[</span><span class="nx">y</span><span class="o">/</span><span class="nx">N</span><span class="p">]:</span><span class="w"> </span><span class="nx">n</span>

<span class="nx">Would</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="nx">monitoring</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">CloudWatch</span><span class="w"> </span><span class="nx">Application</span><span class="w"> </span><span class="nx">Insights</span><span class="p">?</span><span class="w"> </span><span class="p">[</span><span class="nx">y</span><span class="o">/</span><span class="nx">N</span><span class="p">]:</span><span class="w"> </span><span class="nx">n</span>

<span class="nx">Project</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">[</span><span class="nx">sam</span><span class="o">-</span><span class="nx">app</span><span class="p">]:</span><span class="w"> </span><span class="nx">vinilos</span><span class="o">-</span><span class="kn">api</span>
</code></pre></div>

<p>Resultado:</p>
<div class="highlight"><pre><span></span><code><span class="nx">vinilos</span><span class="o">-</span><span class="kn">api</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">yaml</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="nx">handlers</span><span class="o">/</span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="nx">hello</span><span class="o">-</span><span class="nx">world</span><span class="o">/</span>
<span class="err">│</span><span class="w">           </span><span class="err">├──</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="err">│</span><span class="w">           </span><span class="err">└──</span><span class="w"> </span><span class="kn">package</span><span class="p">.</span><span class="nx">json</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">events</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">json</span>
<span class="err">└──</span><span class="w"> </span><span class="nx">README</span><span class="p">.</span><span class="nx">md</span>
</code></pre></div>

<h3 id="opcion-b-estructura-manual-nuestro-caso">Opción B: Estructura Manual (Nuestro Caso)</h3>
<p>Como ya hemos creado la estructura en <code>sam-example/</code>, no necesitamos <code>sam init</code>.</p>
<hr />
<h2 id="2-paso-2-develop-escribir-codigo">2️⃣ Paso 2: DEVELOP - Escribir Código</h2>
<h3 id="estructura-recomendada">Estructura Recomendada</h3>
<div class="highlight"><pre><span></span><code><span class="nx">sam</span><span class="o">-</span><span class="nx">example</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">yaml</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="nx">Infraestructura</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">samconfig</span><span class="p">.</span><span class="nx">toml</span><span class="w">             </span><span class="err">#</span><span class="w"> </span><span class="nx">Configuración</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">deploy</span>
<span class="err">├──</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="nx">handlers</span><span class="o">/</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="nx">get</span><span class="o">-</span><span class="nx">vinilos</span><span class="o">/</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="nx">Código</span><span class="w"> </span><span class="nx">Lambda</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="kn">package</span><span class="p">.</span><span class="nx">json</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="nx">Dependencias</span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="nx">create</span><span class="o">-</span><span class="nx">vinilo</span><span class="o">/</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="nx">siguiente</span><span class="w"> </span><span class="nx">iteración</span><span class="p">)</span>
<span class="err">│</span><span class="w">           </span><span class="err">├──</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="err">│</span><span class="w">           </span><span class="err">└──</span><span class="w"> </span><span class="kn">package</span><span class="p">.</span><span class="nx">json</span>
<span class="err">└──</span><span class="w"> </span><span class="nx">scripts</span><span class="o">/</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="nx">seed</span><span class="o">-</span><span class="nx">dynamodb</span><span class="p">.</span><span class="nx">js</span>
</code></pre></div>

<h3 id="ejemplo-handler-de-lambda">Ejemplo: Handler de Lambda</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/handlers/get-vinilos/index.js</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DynamoDBClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DynamoDBDocumentClient</span><span class="p">,</span><span class="w"> </span><span class="nx">ScanCommand</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@aws-sdk/lib-dynamodb&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ddbClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DynamoDBClient</span><span class="p">({</span><span class="w"> </span><span class="nx">region</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGION</span><span class="w"> </span><span class="p">});</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">docClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DynamoDBDocumentClient</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">ddbClient</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Event:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">TableName</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TABLE_NAME</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">docClient</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">ScanCommand</span><span class="p">(</span><span class="nx">params</span><span class="p">));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">            </span><span class="nx">vinilos</span><span class="o">:</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Items</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="instalar-dependencias">Instalar Dependencias</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>src/handlers/get-vinilos
npm<span class="w"> </span>install
<span class="nb">cd</span><span class="w"> </span>../../..
</code></pre></div>

<hr />
<h2 id="3-paso-3-build-empaquetar-codigo">3️⃣ Paso 3: BUILD - Empaquetar Código</h2>
<p>El comando <code>sam build</code> hace varias cosas:</p>
<ol>
<li><strong>Lee template.yaml</strong> para saber qué funciones Lambda existen</li>
<li><strong>Instala dependencias</strong> (ejecuta <code>npm install</code> en cada handler)</li>
<li><strong>Empaqueta código</strong> en una estructura optimizada</li>
<li><strong>Genera <code>.aws-sam/</code></strong> con todo listo para desplegar</li>
</ol>
<h3 id="ejecutar-build">Ejecutar Build</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
</code></pre></div>

<p><strong>Output esperado</strong>:</p>
<div class="highlight"><pre><span></span><code>Building codeuri: /path/to/src/handlers/get-vinilos runtime: nodejs20.x
Running NodejsNpmBuilder:NpmPack
Running NodejsNpmBuilder:CopyNpmrc
Running NodejsNpmBuilder:CopySource
Running NodejsNpmBuilder:NpmInstall
Running NodejsNpmBuilder:CleanUpNpmrc

Build Succeeded

Built Artifacts  : .aws-sam/build
Built Template   : .aws-sam/build/template.yaml
</code></pre></div>

<h3 id="estructura-generada">Estructura Generada</h3>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nx">aws</span><span class="o">-</span><span class="nx">sam</span><span class="o">/</span>
<span class="err">└──</span><span class="w"> </span><span class="nx">build</span><span class="o">/</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">yaml</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="nx">Template</span><span class="w"> </span><span class="nx">procesado</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="nx">GetVinilosFunction</span><span class="o">/</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nx">Código</span><span class="w"> </span><span class="nx">empaquetado</span>
<span class="w">        </span><span class="err">├──</span><span class="w"> </span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="w">        </span><span class="err">├──</span><span class="w"> </span><span class="kn">package</span><span class="p">.</span><span class="nx">json</span>
<span class="w">        </span><span class="err">└──</span><span class="w"> </span><span class="nx">node_modules</span><span class="o">/</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="nx">Dependencias</span><span class="w"> </span><span class="nx">incluidas</span>
</code></pre></div>

<p><strong>💡 Tip</strong>: <code>.aws-sam/</code> debe estar en <code>.gitignore</code> (no se versiona).</p>
<h3 id="build-options">Build Options</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build con cache (más rápido en builds sucesivos)</span>
sam<span class="w"> </span>build<span class="w"> </span>--cached

<span class="c1"># Build en paralelo (múltiples funciones al mismo tiempo)</span>
sam<span class="w"> </span>build<span class="w"> </span>--parallel

<span class="c1"># Build específico de una función</span>
sam<span class="w"> </span>build<span class="w"> </span>GetVinilosFunction
</code></pre></div>

<hr />
<h2 id="4-paso-4-test-local-probar-localmente-opcional">4️⃣ Paso 4: TEST LOCAL - Probar Localmente (Opcional)</h2>
<p>SAM puede ejecutar Lambda <strong>localmente sin desplegar a AWS</strong> usando Docker.</p>
<h3 id="41-probar-lambda-directamente">4.1 Probar Lambda Directamente</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>invoke<span class="w"> </span>GetVinilosFunction
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Invoking</span><span class="w"> </span><span class="n">index</span><span class="o">.</span><span class="n">handler</span><span class="w"> </span><span class="p">(</span><span class="n">nodejs20</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">Skip</span><span class="w"> </span><span class="n">pulling</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">one</span><span class="p">:</span><span class="w"> </span><span class="n">amazon</span><span class="o">/</span><span class="n">aws</span><span class="o">-</span><span class="n">sam</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="n">emulation</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">nodejs20</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">rapid</span><span class="o">-</span><span class="mf">1.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span>

<span class="n">Mounting</span><span class="w"> </span><span class="o">/</span><span class="n">path</span><span class="o">/.</span><span class="n">aws</span><span class="o">-</span><span class="n">sam</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">GetVinilosFunction</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">task</span><span class="p">:</span><span class="n">ro</span>
<span class="n">START</span><span class="w"> </span><span class="n">RequestId</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span><span class="n">fdfc07</span><span class="o">-</span><span class="mi">2182</span><span class="o">-</span><span class="mi">154</span><span class="n">f</span><span class="o">-</span><span class="mi">163</span><span class="n">f</span><span class="o">-</span><span class="mi">5</span><span class="n">f0f9a621d72</span><span class="w"> </span><span class="n">Version</span><span class="p">:</span><span class="w"> </span><span class="o">$</span><span class="n">LATEST</span>
<span class="n">END</span><span class="w"> </span><span class="n">RequestId</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span><span class="n">fdfc07</span><span class="o">-</span><span class="mi">2182</span><span class="o">-</span><span class="mi">154</span><span class="n">f</span><span class="o">-</span><span class="mi">163</span><span class="n">f</span><span class="o">-</span><span class="mi">5</span><span class="n">f0f9a621d72</span>
<span class="n">REPORT</span><span class="w"> </span><span class="n">Duration</span><span class="p">:</span><span class="w"> </span><span class="mf">523.45</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="n">Billed</span><span class="w"> </span><span class="n">Duration</span><span class="p">:</span><span class="w"> </span><span class="mi">524</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="n">Memory</span><span class="w"> </span><span class="n">Size</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">MB</span>

<span class="p">{</span><span class="s2">&quot;statusCode&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="s2">&quot;body&quot;</span><span class="p">:</span><span class="s2">&quot;...&quot;</span><span class="p">}</span>
</code></pre></div>

<h3 id="42-probar-con-evento-custom">4.2 Probar con Evento Custom</h3>
<p>Crea un archivo <code>events/test-event.json</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;httpMethod&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/vinilos&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Accept&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Invoca con el evento:</p>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>invoke<span class="w"> </span>GetVinilosFunction<span class="w"> </span>-e<span class="w"> </span>events/test-event.json
</code></pre></div>

<h3 id="43-correr-api-gateway-localmente">4.3 Correr API Gateway Localmente</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>start-api
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Mounting</span><span class="w"> </span><span class="n">GetVinilosFunction</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">3000</span><span class="o">/</span><span class="n">vinilos</span><span class="w"> </span><span class="o">[</span><span class="n">GET</span><span class="o">]</span>
<span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="k">browse</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">endpoints</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">functions</span><span class="p">.</span>
</code></pre></div>

<p>Prueba desde otro terminal:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>http://127.0.0.1:3000/vinilos
</code></pre></div>

<p><strong>⚠️ Limitaciones de Local Testing</strong>:<br />
- DynamoDB local requiere configuración adicional<br />
- No simula IAM roles exactamente igual<br />
- Latencias diferentes a AWS real</p>
<hr />
<h2 id="5-paso-5-deploy-desplegar-a-aws">5️⃣ Paso 5: DEPLOY - Desplegar a AWS</h2>
<h3 id="primera-vez-deploy-guiado">Primera vez: Deploy Guiado</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>deploy<span class="w"> </span>--guided
</code></pre></div>

<p>SAM te preguntará:</p>
<div class="highlight"><pre><span></span><code><span class="n">Stack</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">[</span><span class="n">sam-app</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span><span class="o">-</span><span class="n">vinilos</span><span class="o">-</span><span class="n">stack</span>
<span class="n">AWS</span><span class="w"> </span><span class="n">Region</span><span class="w"> </span><span class="o">[</span><span class="n">us-east-1</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span>
<span class="k">Parameter</span><span class="w"> </span><span class="n">StudentPrefix</span><span class="w"> </span><span class="err">[]:</span><span class="w"> </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span>
<span class="n">Confirm</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="o">[</span><span class="n">Y/n</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">y</span>
<span class="n">Allow</span><span class="w"> </span><span class="n">SAM</span><span class="w"> </span><span class="n">CLI</span><span class="w"> </span><span class="n">IAM</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">creation</span><span class="w"> </span><span class="o">[</span><span class="n">Y/n</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">y</span>
<span class="n">Disable</span><span class="w"> </span><span class="k">rollback</span><span class="w"> </span><span class="o">[</span><span class="n">y/N</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">n</span>
<span class="n">GetVinilosFunction</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">authorization</span><span class="w"> </span><span class="n">defined</span><span class="p">,</span><span class="w"> </span><span class="k">Is</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">okay</span><span class="vm">?</span><span class="w"> </span><span class="o">[</span><span class="n">y/N</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">y</span>
<span class="k">Save</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">[</span><span class="n">Y/n</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">y</span>
<span class="n">SAM</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">[</span><span class="n">samconfig.toml</span><span class="o">]</span><span class="err">:</span>
<span class="n">SAM</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="o">[</span><span class="n">default</span><span class="o">]</span><span class="err">:</span>
</code></pre></div>

<p>SAM creará <code>samconfig.toml</code> con estas respuestas:</p>
<div class="highlight"><pre><span></span><code><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>
<span class="k">[default.deploy.parameters]</span>
<span class="n">stack_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;juan-perez-a7b3f-vinilos-stack&quot;</span>
<span class="n">s3_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aws-sam-cli-managed-default-samclisourcebucket-xxx&quot;</span>
<span class="n">s3_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;juan-perez-a7b3f-vinilos&quot;</span>
<span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;eu-west-1&quot;</span>
<span class="n">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CAPABILITY_IAM&quot;</span>
<span class="n">parameter_overrides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;StudentPrefix=juan-perez-a7b3f&quot;</span>
</code></pre></div>

<p><strong>Proceso de Deploy</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Uploading</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">aws</span><span class="o">-</span><span class="n">sam</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="n">managed</span><span class="o">.../</span><span class="n">xxx</span><span class="o">.</span><span class="n">zip</span>
<span class="n">Waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">changeset</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">created</span><span class="o">...</span>
<span class="n">CloudFormation</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">changeset</span>

<span class="o">---------------------------------------------------------------------</span>
<span class="n">Operation</span><span class="w">            </span><span class="n">LogicalResourceId</span><span class="w">       </span><span class="n">ResourceType</span>
<span class="o">---------------------------------------------------------------------</span>
<span class="o">+</span><span class="w"> </span><span class="n">Add</span><span class="w">                </span><span class="n">GetVinilosFunction</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">Lambda</span><span class="p">::</span><span class="n">Function</span>
<span class="o">+</span><span class="w"> </span><span class="n">Add</span><span class="w">                </span><span class="n">VinilosHttpApi</span><span class="w">          </span><span class="n">AWS</span><span class="p">::</span><span class="n">ApiGatewayV2</span><span class="p">::</span><span class="n">Api</span>
<span class="o">+</span><span class="w"> </span><span class="n">Add</span><span class="w">                </span><span class="n">VinilosTable</span><span class="w">            </span><span class="n">AWS</span><span class="p">::</span><span class="n">DynamoDB</span><span class="p">::</span><span class="n">Table</span>
<span class="o">+</span><span class="w"> </span><span class="n">Add</span><span class="w">                </span><span class="n">VinilosImagesBucket</span><span class="w">     </span><span class="n">AWS</span><span class="p">::</span><span class="n">S3</span><span class="p">::</span><span class="n">Bucket</span>
<span class="o">---------------------------------------------------------------------</span>

<span class="n">Changeset</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">successfully</span><span class="o">.</span><span class="w"> </span><span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">cloudformation</span><span class="p">:</span><span class="o">...</span>

<span class="n">Deploy</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">changeset</span><span class="err">?</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]:</span><span class="w"> </span><span class="n">y</span>

<span class="n">CREATE_IN_PROGRESS</span><span class="w">   </span><span class="n">AWS</span><span class="p">::</span><span class="n">CloudFormation</span><span class="p">::</span><span class="n">Stack</span><span class="w">   </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span><span class="o">-</span><span class="n">vinilos</span><span class="o">-</span><span class="n">stack</span>
<span class="n">CREATE_IN_PROGRESS</span><span class="w">   </span><span class="n">AWS</span><span class="p">::</span><span class="n">S3</span><span class="p">::</span><span class="n">Bucket</span><span class="w">              </span><span class="n">VinilosImagesBucket</span>
<span class="n">CREATE_IN_PROGRESS</span><span class="w">   </span><span class="n">AWS</span><span class="p">::</span><span class="n">DynamoDB</span><span class="p">::</span><span class="n">Table</span><span class="w">         </span><span class="n">VinilosTable</span>
<span class="n">CREATE_COMPLETE</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">S3</span><span class="p">::</span><span class="n">Bucket</span><span class="w">              </span><span class="n">VinilosImagesBucket</span>
<span class="n">CREATE_COMPLETE</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">DynamoDB</span><span class="p">::</span><span class="n">Table</span><span class="w">         </span><span class="n">VinilosTable</span>
<span class="n">CREATE_IN_PROGRESS</span><span class="w">   </span><span class="n">AWS</span><span class="p">::</span><span class="n">Lambda</span><span class="p">::</span><span class="n">Function</span><span class="w">        </span><span class="n">GetVinilosFunction</span>
<span class="n">CREATE_COMPLETE</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">Lambda</span><span class="p">::</span><span class="n">Function</span><span class="w">        </span><span class="n">GetVinilosFunction</span>
<span class="n">CREATE_IN_PROGRESS</span><span class="w">   </span><span class="n">AWS</span><span class="p">::</span><span class="n">ApiGatewayV2</span><span class="p">::</span><span class="n">Api</span><span class="w">       </span><span class="n">VinilosHttpApi</span>
<span class="n">CREATE_COMPLETE</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">ApiGatewayV2</span><span class="p">::</span><span class="n">Api</span><span class="w">       </span><span class="n">VinilosHttpApi</span>
<span class="n">CREATE_COMPLETE</span><span class="w">      </span><span class="n">AWS</span><span class="p">::</span><span class="n">CloudFormation</span><span class="p">::</span><span class="n">Stack</span><span class="w">   </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span><span class="o">-</span><span class="n">vinilos</span><span class="o">-</span><span class="n">stack</span>

<span class="n">CloudFormation</span><span class="w"> </span><span class="n">outputs</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">deployed</span><span class="w"> </span><span class="n">stack</span>
<span class="o">------------------------------------------------------------------------</span>
<span class="n">Outputs</span>
<span class="o">------------------------------------------------------------------------</span>
<span class="n">Key</span><span class="w">                 </span><span class="n">VinilosApiUrl</span>
<span class="n">Description</span><span class="w">         </span><span class="n">API</span><span class="w"> </span><span class="n">Gateway</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="n">URL</span>
<span class="n">Value</span><span class="w">               </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">abcd1234</span><span class="o">.</span><span class="n">execute</span><span class="o">-</span><span class="n">api</span><span class="o">.</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">1.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vinilos</span>
<span class="o">------------------------------------------------------------------------</span>

<span class="n">Successfully</span><span class="w"> </span><span class="n">created</span><span class="o">/</span><span class="n">updated</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span><span class="o">-</span><span class="n">vinilos</span><span class="o">-</span><span class="n">stack</span>
</code></pre></div>

<p>⏱️ <strong>Tiempo</strong>: 2-3 minutos para crear todo.</p>
<h3 id="deploys-siguientes-automatico">Deploys Siguientes: Automático</h3>
<p>Una vez que <code>samconfig.toml</code> existe:</p>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
sam<span class="w"> </span>deploy
</code></pre></div>

<p>Ya no preguntará nada, usará la configuración guardada.</p>
<hr />
<h2 id="6-paso-6-monitor-ver-logs">6️⃣ Paso 6: MONITOR - Ver Logs</h2>
<h3 id="ver-logs-de-una-funcion">Ver Logs de una Función</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>GetVinilosFunction<span class="w"> </span>--stack-name<span class="w"> </span>juan-perez-a7b3f-vinilos-stack
</code></pre></div>

<h3 id="ver-logs-en-tiempo-real-tail">Ver Logs en Tiempo Real (Tail)</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>GetVinilosFunction<span class="w"> </span>--stack-name<span class="w"> </span>juan-perez-a7b3f-vinilos-stack<span class="w"> </span>--tail
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="mf">2025</span><span class="o">/</span><span class="mf">01</span><span class="o">/</span><span class="mf">15</span><span class="o">/</span><span class="err">[$</span><span class="n">LATEST</span><span class="err">]</span><span class="n">abc123</span><span class="w"> </span><span class="mf">2025</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="n">T10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45.123000</span><span class="w"> </span><span class="n">START</span><span class="w"> </span><span class="n">RequestId</span><span class="p">:</span><span class="w"> </span><span class="n">xxx</span>
<span class="mf">2025</span><span class="o">/</span><span class="mf">01</span><span class="o">/</span><span class="mf">15</span><span class="o">/</span><span class="err">[$</span><span class="n">LATEST</span><span class="err">]</span><span class="n">abc123</span><span class="w"> </span><span class="mf">2025</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="n">T10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45.456000</span><span class="w"> </span><span class="n">Lambda</span><span class="w"> </span><span class="n">invocada</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kr">GET</span><span class="w"> </span><span class="n">vinilos</span>
<span class="mf">2025</span><span class="o">/</span><span class="mf">01</span><span class="o">/</span><span class="mf">15</span><span class="o">/</span><span class="err">[$</span><span class="n">LATEST</span><span class="err">]</span><span class="n">abc123</span><span class="w"> </span><span class="mf">2025</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="n">T10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45.789000</span><span class="w"> </span><span class="n">DynamoDB</span><span class="w"> </span><span class="n">Scan</span><span class="w"> </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="n">items</span>
<span class="mf">2025</span><span class="o">/</span><span class="mf">01</span><span class="o">/</span><span class="mf">15</span><span class="o">/</span><span class="err">[$</span><span class="n">LATEST</span><span class="err">]</span><span class="n">abc123</span><span class="w"> </span><span class="mf">2025</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="n">T10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">46.012000</span><span class="w"> </span><span class="kr">END</span><span class="w"> </span><span class="n">RequestId</span><span class="p">:</span><span class="w"> </span><span class="n">xxx</span>
<span class="mf">2025</span><span class="o">/</span><span class="mf">01</span><span class="o">/</span><span class="mf">15</span><span class="o">/</span><span class="err">[$</span><span class="n">LATEST</span><span class="err">]</span><span class="n">abc123</span><span class="w"> </span><span class="mf">2025</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="n">T10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">46.012000</span><span class="w"> </span><span class="n">REPORT</span><span class="w"> </span><span class="n">Duration</span><span class="p">:</span><span class="w"> </span><span class="mf">523</span><span class="n">ms</span>
</code></pre></div>

<h3 id="filtrar-logs">Filtrar Logs</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Solo errores</span>
sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>GetVinilosFunction<span class="w"> </span>--stack-name<span class="w"> </span><span class="o">{</span>stack<span class="o">}</span><span class="w"> </span>--filter<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span>

<span class="c1"># Últimas 10 líneas</span>
sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>GetVinilosFunction<span class="w"> </span>--stack-name<span class="w"> </span><span class="o">{</span>stack<span class="o">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-10

<span class="c1"># Entre fechas</span>
sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>GetVinilosFunction<span class="w"> </span>--stack-name<span class="w"> </span><span class="o">{</span>stack<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--start-time<span class="w"> </span><span class="s1">&#39;2025-01-15T10:00:00&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--end-time<span class="w"> </span><span class="s1">&#39;2025-01-15T11:00:00&#39;</span>
</code></pre></div>

<hr />
<h2 id="7-paso-7-update-actualizar-aplicacion">7️⃣ Paso 7: UPDATE - Actualizar Aplicación</h2>
<h3 id="cambiar-codigo-lambda">Cambiar Código Lambda</h3>
<ol>
<li><strong>Edita el código</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">// src/handlers/get-vinilos/index.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;🎵 Nueva versión - GET vinilos&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// &lt;- Cambio</span>
<span class="w">    </span><span class="c1">// ...resto del código</span>
<span class="p">};</span>
</code></pre></div>

<ol start="2">
<li><strong>Build y deploy</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
sam<span class="w"> </span>deploy
</code></pre></div>

<p><strong>SAM detectará el cambio</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c">Changeset:</span>
<span class="nb">---------------------------------------------------------------------</span>
<span class="c">Operation            LogicalResourceId       ResourceType</span>
<span class="nb">---------------------------------------------------------------------</span>
<span class="c">* Update             GetVinilosFunction      AWS::Lambda::Function</span>
<span class="nb">---------------------------------------------------------------------</span>

<span class="c">Deploy this changeset? </span><span class="k">[</span><span class="c">y/N</span><span class="k">]</span><span class="c">: y</span>
</code></pre></div>

<p>⏱️ <strong>Tiempo update</strong>: 30-60 segundos (mucho más rápido que crear).</p>
<hr />
<h3 id="cambiar-infraestructura-template">Cambiar Infraestructura (Template)</h3>
<ol>
<li><strong>Edita <code>template.yaml</code></strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">GetVinilosFunction</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
<span class="w">  </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">    </span><span class="nt">MemorySize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w">  </span><span class="c1"># &lt;- Cambio: de 128MB a 256MB</span>
<span class="w">    </span><span class="nt">Timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">      </span><span class="c1"># &lt;- Cambio: de 10s a 15s</span>
</code></pre></div>

<ol start="2">
<li><strong>Build y deploy</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
sam<span class="w"> </span>deploy
</code></pre></div>

<p>SAM actualizará la configuración de la Lambda sin eliminarla.</p>
<hr />
<h3 id="anadir-un-nuevo-recurso">Añadir un Nuevo Recurso</h3>
<ol>
<li><strong>Añadir nueva función en <code>template.yaml</code></strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">Resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">GetVinilosFunction</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ... ya existe</span>

<span class="w">  </span><span class="nt">CreateViniloFunction</span><span class="p">:</span><span class="w">  </span><span class="c1"># &lt;- NUEVO</span>
<span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::Serverless::Function</span>
<span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">FunctionName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Sub</span><span class="w"> </span><span class="s">&#39;${StudentPrefix}-create-vinilo&#39;</span>
<span class="w">      </span><span class="nt">CodeUri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src/handlers/create-vinilo/</span>
<span class="w">      </span><span class="nt">Handler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">index.handler</span>
<span class="w">      </span><span class="nt">Runtime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodejs20.x</span>
<span class="w">      </span><span class="nt">Events</span><span class="p">:</span>
<span class="w">        </span><span class="nt">CreateVinilo</span><span class="p">:</span>
<span class="w">          </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HttpApi</span>
<span class="w">          </span><span class="nt">Properties</span><span class="p">:</span>
<span class="w">            </span><span class="nt">Path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/vinilos</span>
<span class="w">            </span><span class="nt">Method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post</span>
<span class="w">            </span><span class="nt">ApiId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VinilosHttpApi</span>
</code></pre></div>

<ol start="2">
<li><strong>Crear el handler</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>src/handlers/create-vinilo
<span class="c1"># Copiar código...</span>
</code></pre></div>

<ol start="3">
<li><strong>Deploy</strong>:</li>
</ol>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
sam<span class="w"> </span>deploy
</code></pre></div>

<p><strong>SAM añadirá el nuevo recurso</strong>:</p>
<div class="highlight"><pre><span></span><code>Changeset:
+ Add                CreateViniloFunction    AWS::Lambda::Function
+ Add                CreateViniloApiRoute    AWS::ApiGatewayV2::Route
</code></pre></div>

<hr />
<h2 id="8-paso-8-delete-eliminar-stack">8️⃣ Paso 8: DELETE - Eliminar Stack</h2>
<h3 id="eliminar-todo">Eliminar Todo</h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>delete<span class="w"> </span>--stack-name<span class="w"> </span>juan-perez-a7b3f-vinilos-stack
</code></pre></div>

<p>SAM preguntará:</p>
<div class="highlight"><pre><span></span><code><span class="n">Are</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">juan</span><span class="o">-</span><span class="n">perez</span><span class="o">-</span><span class="n">a7b3f</span><span class="o">-</span><span class="n">vinilos</span><span class="o">-</span><span class="n">stack</span>
<span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mh">1</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">y</span>

<span class="n">Are</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">folder</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">S3</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">contains</span>
<span class="n">the</span><span class="w"> </span><span class="n">artifacts</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">y</span>
</code></pre></div>

<p><strong>⚠️ Esto eliminará</strong>:<br />
- ✅ Lambda functions<br />
- ✅ API Gateway<br />
- ✅ DynamoDB table <strong>(con todos los datos)</strong><br />
- ✅ S3 bucket <strong>(con todas las imágenes)</strong><br />
- ✅ IAM roles<br />
- ✅ CloudWatch logs (después de retention period)</p>
<p><strong>🔒 No se puede deshacer</strong>.</p>
<hr />
<h2 id="workflow-rapido-referencia">🚀 Workflow Rápido (Referencia)</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Desarrollo inicial</span>
sam<span class="w"> </span>init<span class="w">                  </span><span class="c1"># (opcional) Crear estructura</span>
<span class="nb">cd</span><span class="w"> </span>my-project

<span class="c1"># Ciclo de desarrollo</span>
vim<span class="w"> </span>src/handlers/my-func/index.js<span class="w">  </span><span class="c1"># Escribir código</span>
vim<span class="w"> </span>template.yaml<span class="w">                  </span><span class="c1"># Definir infraestructura</span>
<span class="nb">cd</span><span class="w"> </span>src/handlers/my-func<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../../..

<span class="c1"># Build y deploy</span>
sam<span class="w"> </span>build
sam<span class="w"> </span>deploy<span class="w"> </span>--guided<span class="w">      </span><span class="c1"># Primera vez</span>

<span class="c1"># Cambios posteriores</span>
vim<span class="w"> </span>src/handlers/my-func/index.js
sam<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sam<span class="w"> </span>deploy<span class="w">  </span><span class="c1"># Rápido</span>

<span class="c1"># Testing local (opcional)</span>
sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>invoke<span class="w"> </span>MyFunction
sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>start-api

<span class="c1"># Monitoring</span>
sam<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>MyFunction<span class="w"> </span>--stack-name<span class="w"> </span>my-stack<span class="w"> </span>--tail

<span class="c1"># Cleanup</span>
sam<span class="w"> </span>delete<span class="w"> </span>--stack-name<span class="w"> </span>my-stack
</code></pre></div>

<hr />
<h2 id="best-practices">🎯 Best Practices</h2>
<h3 id="1-siempre-usa-samconfigtoml">1. <strong>Siempre usa <code>samconfig.toml</code></strong></h3>
<p>No re-escribas parámetros en cada deploy.</p>
<h3 id="2-usa-cached-para-builds-rapidos">2. <strong>Usa <code>--cached</code> para builds rápidos</strong></h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build<span class="w"> </span>--cached<span class="w"> </span>--parallel
</code></pre></div>

<h3 id="3-nombra-stacks-con-prefijo">3. <strong>Nombra stacks con prefijo</strong></h3>
<div class="highlight"><pre><span></span><code>{prefijo}-{app}-stack
juan-perez-a7b3f-vinilos-stack
</code></pre></div>

<h3 id="4-versiona-templateyaml-y-samconfigtoml-template">4. <strong>Versiona <code>template.yaml</code> y <code>samconfig.toml</code> (template)</strong></h3>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>template.yaml<span class="w"> </span>samconfig.toml.example
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: add create vinilo endpoint&quot;</span>
</code></pre></div>

<p><strong>⚠️ NO versiones <code>samconfig.toml</code> si contiene datos sensibles</strong> (usa <code>.example</code> para plantilla).</p>
<h3 id="5-testea-localmente-antes-de-deploy">5. <strong>Testea localmente antes de deploy</strong></h3>
<div class="highlight"><pre><span></span><code>sam<span class="w"> </span>build
sam<span class="w"> </span><span class="nb">local</span><span class="w"> </span>invoke<span class="w"> </span>MyFunction<span class="w">  </span><span class="c1"># Verifica que funciona</span>
sam<span class="w"> </span>deploy
</code></pre></div>

<hr />
<h2 id="checklist-de-verificacion">✅ Checklist de Verificación</h2>
<p>Antes de continuar, asegúrate de que:</p>
<ul>
<li>[ ] Sabes crear proyectos con <code>sam init</code> (opcional)</li>
<li>[ ] Entiendes qué hace <code>sam build</code></li>
<li>[ ] Has desplegado con <code>sam deploy --guided</code></li>
<li>[ ] Sabes usar <code>sam local invoke</code> y <code>sam local start-api</code></li>
<li>[ ] Puedes ver logs con <code>sam logs --tail</code></li>
<li>[ ] Sabes cómo actualizar código e infraestructura</li>
<li>[ ] Conoces cómo eliminar stacks con <code>sam delete</code></li>
</ul>
<hr />
<h2 id="proximo-paso">🚀 Próximo Paso</h2>
<p>Ya dominas el workflow SAM. En la siguiente sección:</p>
<p><strong><a href="./03-post-vinilos.html">Añadir funcionalidad: POST /vinilos</a></strong></p>
<p>Aprenderás a extender la aplicación con un endpoint para <strong>crear vinilos</strong>.</p>
<hr />
<h2 id="referencias">📖 Referencias</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-command-reference.html">SAM CLI Command Reference</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-build.html">SAM Build</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-deploy.html">SAM Deploy</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-using-local-testing.html">SAM Local Testing</a></li>
</ul>
        </div>
    </div>

    <!-- JavaScript for student prefix management -->
    <script src="../scripts/student-prefix.js"></script>
    <!-- JavaScript for sidebar navigation -->
    <script src="../scripts/sidebar-nav.js"></script>
    <!-- JavaScript for copy code buttons -->
    <script src="../scripts/copy-code.js"></script>
</body>
</html>