<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>01 Lambda Hardcoded - Goikode Serverless Secure Course</title>
    <link rel="stylesheet" href="../styles/goikode-docs.css">
</head>
<body>
    <!-- Header with logo and student prefix -->
    <header class="doc-header">
        <div class="doc-header-left">
            <a href="../index.html" class="logo-link">
                <img src="../assets/brand/logo.svg" alt="Goikode" class="doc-logo" onerror="this.src='../assets/brand/logo.png'">
            </a>
            <h1 class="doc-title">01 Lambda Hardcoded</h1>
        </div>
        <div class="doc-header-right">
            <div class="student-prefix-display">
                <span class="student-prefix-label">Tu prefijo:</span>
                <span id="header-student-prefix">-</span>
            </div>
            <button id="change-prefix-btn">Cambiar Prefijo</button>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>√çndice del Curso</h2>
            <button class="sidebar-toggle" id="sidebar-toggle">‚úï</button>
        </div>
        <div class="sidebar-content" id="sidebar-content">
            <div class="sidebar-loading">Cargando √≠ndice...</div>
        </div>
    </aside>

    <!-- Toggle button for mobile -->
    <button class="sidebar-open-btn" id="sidebar-open-btn">‚ò∞</button>

    <!-- Main content container -->
    <div class="doc-container with-sidebar">
        <div class="doc-content">
            <h1 id="iteracion-1-lambda-con-datos-hardcoded">Iteraci√≥n 1: Lambda con Datos Hardcoded</h1>
<h2 id="crear-tu-primera-funcion-lambda">Crear tu Primera Funci√≥n Lambda</h2>
<hr />
<h2 id="objetivo">üéØ Objetivo</h2>
<p>Crear una funci√≥n Lambda desde la consola de AWS que devuelva un cat√°logo de 5 vinilos con datos hardcoded (sin base de datos todav√≠a).</p>
<hr />
<h2 id="conceptos-clave">üìö Conceptos Clave</h2>
<h3 id="que-es-aws-lambda">¬øQu√© es AWS Lambda?</h3>
<p>AWS Lambda es un servicio de computaci√≥n serverless que ejecuta tu c√≥digo en respuesta a eventos. Caracter√≠sticas principales:</p>
<ul>
<li>‚úÖ <strong>Sin servidores que gestionar</strong>: AWS se encarga de toda la infraestructura</li>
<li>‚úÖ <strong>Pago por uso</strong>: Solo pagas por el tiempo de ejecuci√≥n (milisegundos)</li>
<li>‚úÖ <strong>Escalado autom√°tico</strong>: De 0 a miles de ejecuciones concurrentes</li>
<li>‚úÖ <strong>M√∫ltiples lenguajes</strong>: Node.js, Python, Java, Go, .NET, Ruby</li>
</ul>
<h3 id="anatomia-de-una-funcion-lambda">Anatom√≠a de una Funci√≥n Lambda</h3>
<div class="highlight"><pre><span></span><code><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// event: informaci√≥n sobre qui√©n invoc√≥ la Lambda</span>

<span class="w">    </span><span class="c1">// Tu l√≥gica aqu√≠</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w">  </span><span class="c1">// C√≥digo HTTP</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">mensaje</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hola&quot;</span><span class="w"> </span><span class="p">})</span><span class="w">  </span><span class="c1">// Respuesta</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>

<hr />
<h2 id="paso-a-paso">üõ†Ô∏è Paso a Paso</h2>
<h3 id="paso-1-navegar-a-aws-lambda"><strong>Paso 1: Navegar a AWS Lambda</strong></h3>
<ol>
<li>Inicia sesi√≥n en la consola de AWS: https://console.aws.amazon.com</li>
<li>En la barra de b√∫squeda superior, escribe <strong>"Lambda"</strong></li>
<li>Haz clic en <strong>"Lambda"</strong> (servicio)</li>
<li>Aseg√∫rate de que est√°s en la regi√≥n <strong>EU (Ireland) eu-west-1</strong> (esquina superior derecha)</li>
</ol>
<hr />
<h3 id="paso-2-crear-la-funcion-lambda"><strong>Paso 2: Crear la Funci√≥n Lambda</strong></h3>
<ol>
<li>Haz clic en el bot√≥n naranja <strong>"Create function"</strong></li>
<li>Selecciona <strong>"Author from scratch"</strong> (crear desde cero)</li>
<li>
<p>Configuraci√≥n:<br />
   - <strong>Function name</strong>: <code>{tu-prefijo}-get-vinilos</code></p>
<ul>
<li>Ejemplo: <code>juan-perez-get-vinilos</code></li>
<li><strong>Runtime</strong>: <code>Node.js 20.x</code> (√∫ltima versi√≥n LTS)</li>
<li><strong>Architecture</strong>: <code>x86_64</code></li>
<li><strong>Permissions</strong>: Deja la opci√≥n por defecto "Create a new role with basic Lambda permissions"</li>
</ul>
</li>
<li>
<p>Haz clic en <strong>"Create function"</strong></p>
</li>
</ol>
<p>‚è±Ô∏è AWS tardar√° unos segundos en crear la funci√≥n.</p>
<hr />
<h3 id="paso-3-escribir-el-codigo"><strong>Paso 3: Escribir el C√≥digo</strong></h3>
<p>Una vez creada la funci√≥n, ver√°s el editor de c√≥digo en l√≠nea.</p>
<ol>
<li><strong>Reemplaza todo el c√≥digo</strong> por el siguiente:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Lambda invocada - GET vinilos&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Cat√°logo hardcoded de vinilos</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">vinilos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">titulo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Abbey Road&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">artista</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Beatles&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">precio</span><span class="o">:</span><span class="w"> </span><span class="mf">25.99</span><span class="p">,</span>
<span class="w">            </span><span class="nx">a√±o</span><span class="o">:</span><span class="w"> </span><span class="mf">1969</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">titulo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Dark Side of the Moon&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">artista</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Pink Floyd&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">precio</span><span class="o">:</span><span class="w"> </span><span class="mf">22.50</span><span class="p">,</span>
<span class="w">            </span><span class="nx">a√±o</span><span class="o">:</span><span class="w"> </span><span class="mf">1973</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">titulo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Thriller&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">artista</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Michael Jackson&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">precio</span><span class="o">:</span><span class="w"> </span><span class="mf">19.99</span><span class="p">,</span>
<span class="w">            </span><span class="nx">a√±o</span><span class="o">:</span><span class="w"> </span><span class="mf">1982</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">titulo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Songs of Leonard Cohen&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">artista</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Leonard Cohen&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">precio</span><span class="o">:</span><span class="w"> </span><span class="mf">23.50</span><span class="p">,</span>
<span class="w">            </span><span class="nx">a√±o</span><span class="o">:</span><span class="w"> </span><span class="mf">1967</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">titulo</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Naturally (Shades)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">artista</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;J.J. Cale&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">precio</span><span class="o">:</span><span class="w"> </span><span class="mf">21.99</span><span class="p">,</span>
<span class="w">            </span><span class="nx">a√±o</span><span class="o">:</span><span class="w"> </span><span class="mf">1971</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Respuesta HTTP</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">            </span><span class="nx">mensaje</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Cat√°logo de vinilos (hardcoded)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="nx">vinilos</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
<span class="w">            </span><span class="nx">vinilos</span><span class="o">:</span><span class="w"> </span><span class="nx">vinilos</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>

<ol start="2">
<li>Haz clic en <strong>"Deploy"</strong> (bot√≥n naranja arriba a la derecha del editor)</li>
</ol>
<p>‚è±Ô∏è Espera el mensaje <strong>"Successfully updated the function..."</strong></p>
<hr />
<h3 id="paso-4-probar-la-funcion"><strong>Paso 4: Probar la Funci√≥n</strong></h3>
<ol>
<li>Haz clic en la pesta√±a <strong>"Test"</strong> (al lado de "Code")</li>
<li>En "Test event action", selecciona <strong>"Create new event"</strong></li>
<li>Configuraci√≥n del evento de prueba:<br />
   - <strong>Event name</strong>: <code>test-get-vinilos</code><br />
   - <strong>Template</strong>: <code>hello-world</code> (deja el JSON por defecto, no importa)</li>
<li>Haz clic en <strong>"Save"</strong></li>
<li>Haz clic en <strong>"Test"</strong> (bot√≥n naranja)</li>
</ol>
<hr />
<h3 id="paso-5-ver-los-resultados"><strong>Paso 5: Ver los Resultados</strong></h3>
<p>Despu√©s de ejecutar el test, ver√°s:</p>
<h4 id="execution-result-succeeded">‚úÖ Execution result: succeeded</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;statusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Content-Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;mensaje\&quot;:\&quot;Cat√°logo de vinilos (hardcoded)\&quot;,\&quot;total\&quot;:5,\&quot;vinilos\&quot;:[...]}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="detalles-de-la-ejecucion">üìä Detalles de la Ejecuci√≥n</h4>
<ul>
<li><strong>Duration</strong>: ~50-100 ms (tiempo de ejecuci√≥n)</li>
<li><strong>Billed duration</strong>: Tiempo que se te cobrar√≠a (redondeado a 100ms)</li>
<li><strong>Memory used</strong>: Memoria consumida</li>
<li><strong>Max memory configured</strong>: Memoria asignada (por defecto 128 MB)</li>
</ul>
<h4 id="logs">üìù Logs</h4>
<p>Ver√°s el log <code>Lambda invocada - GET vinilos</code> que escribimos con <code>console.log()</code></p>
<hr />
<h3 id="paso-6-ver-logs-en-cloudwatch-opcional"><strong>Paso 6: Ver Logs en CloudWatch (Opcional)</strong></h3>
<p>Los logs de Lambda se guardan autom√°ticamente en <strong>CloudWatch Logs</strong>.</p>
<ol>
<li>En la funci√≥n Lambda, ve a la pesta√±a <strong>"Monitor"</strong></li>
<li>Haz clic en <strong>"View CloudWatch logs"</strong></li>
<li>Haz clic en el <strong>log stream</strong> m√°s reciente</li>
<li>Ver√°s todos los <code>console.log()</code> y errores de tu Lambda</li>
</ol>
<hr />
<h2 id="que-has-aprendido">üéì ¬øQu√© has Aprendido?</h2>
<table>
<thead>
<tr>
<th>Concepto</th>
<th>Descripci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Lambda Function</strong></td>
<td>C√≥digo que se ejecuta sin gestionar servidores</td>
</tr>
<tr>
<td><strong>Handler</strong></td>
<td>Funci√≥n principal que AWS invoca (<code>exports.handler</code>)</td>
</tr>
<tr>
<td><strong>Event</strong></td>
<td>Informaci√≥n sobre qui√©n/qu√© invoc√≥ la Lambda</td>
</tr>
<tr>
<td><strong>Response</strong></td>
<td>Objeto con <code>statusCode</code>, <code>headers</code>, <code>body</code></td>
</tr>
<tr>
<td><strong>CloudWatch Logs</strong></td>
<td>Donde se almacenan todos los logs de Lambda</td>
</tr>
<tr>
<td><strong>Execution time</strong></td>
<td>Tiempo que tarda en ejecutarse tu c√≥digo</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>RAM asignada a tu funci√≥n (128MB - 10GB)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="analisis-del-codigo">üîç An√°lisis del C√≥digo</h2>
<h3 id="estructura-de-la-respuesta">Estructura de la Respuesta</h3>
<div class="highlight"><pre><span></span><code><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w">        </span><span class="c1">// C√≥digo HTTP (200 = OK)</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">              </span><span class="c1">// Cabeceras HTTP</span>
<span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w">  </span><span class="c1">// IMPORTANTE: body debe ser STRING</span>
<span class="w">        </span><span class="nx">mensaje</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">vinilos</span><span class="o">:</span><span class="w"> </span><span class="p">[...]</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">};</span>
</code></pre></div>

<p><strong>‚ö†Ô∏è Error Com√∫n</strong>: Olvidar usar <code>JSON.stringify()</code> en el body. Lambda espera un string.</p>
<h3 id="consolelog-en-lambda">console.log() en Lambda</h3>
<div class="highlight"><pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Lambda invocada - GET vinilos&#39;</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>‚úÖ √ötil para debugging</li>
<li>‚úÖ Se guarda en CloudWatch Logs</li>
<li>‚ö†Ô∏è Cada log a√±ade tiempo de ejecuci√≥n (y coste)</li>
<li>üí° En producci√≥n, usa logs estructurados</li>
</ul>
<hr />
<h2 id="costos">üìä Costos</h2>
<p>Lambda es <strong>extremadamente barato</strong> para casos de uso peque√±os:</p>
<ul>
<li><strong>Free Tier</strong>: 1 mill√≥n de peticiones/mes gratis</li>
<li><strong>Precio despu√©s</strong>: $0.20 por 1 mill√≥n de peticiones</li>
<li><strong>Tiempo de c√≥mputo</strong>: $0.0000166667 por GB-segundo</li>
</ul>
<p><strong>Ejemplo</strong>: Esta Lambda (128MB, 100ms) cuesta ~$0.000000208 por ejecuci√≥n.</p>
<hr />
<h2 id="mejoras-posibles-no-implementar-aun">üöÄ Mejoras Posibles (NO implementar a√∫n)</h2>
<p>En las siguientes iteraciones a√±adiremos:<br />
- ‚úÖ <strong>DynamoDB</strong>: Guardar vinilos en base de datos (no hardcoded)<br />
- ‚úÖ <strong>S3</strong>: A√±adir im√°genes de portadas<br />
- ‚úÖ <strong>API Gateway</strong>: Exponer via HTTP (ahora solo se puede probar desde consola)<br />
- ‚úÖ <strong>IAM Roles</strong>: Permisos granulares</p>
<hr />
<h2 id="ejercicios-opcional">üß™ Ejercicios (Opcional)</h2>
<ol>
<li><strong>A√±ade tu vinilo favorito</strong> a la lista</li>
<li><strong>Modifica el c√≥digo</strong> para devolver solo vinilos con <code>precio &lt; 23</code></li>
<li><strong>A√±ade un campo <code>stock</code></strong> a cada vinilo (inventado)</li>
<li><strong>Cambia <code>console.log()</code></strong> para mostrar cu√°ntos vinilos se devolvieron</li>
</ol>
<hr />
<h2 id="checklist-de-verificacion">‚úÖ Checklist de Verificaci√≥n</h2>
<p>Antes de pasar a la siguiente iteraci√≥n, comprueba:</p>
<ul>
<li>[ ] Lambda creada con nombre <code>{tu-prefijo}-get-vinilos</code></li>
<li>[ ] C√≥digo copiado y desplegado correctamente</li>
<li>[ ] Test ejecutado con resultado <strong>succeeded</strong></li>
<li>[ ] Respuesta contiene 5 vinilos en formato JSON</li>
<li>[ ] Logs visibles en la pesta√±a "Monitor"</li>
<li>[ ] Entiendes qu√© hace cada parte del c√≥digo</li>
</ul>
<hr />
<h2 id="troubleshooting">üêõ Troubleshooting</h2>
<h3 id="error-function-not-found">Error: "Function not found"</h3>
<p><strong>Soluci√≥n</strong>: Verifica que est√°s en la regi√≥n correcta (eu-west-1)</p>
<h3 id="error-syntax-error-in-module">Error: "Syntax error in module"</h3>
<p><strong>Soluci√≥n</strong>: Revisa que copiaste todo el c√≥digo correctamente. Haz clic en "Deploy" de nuevo.</p>
<h3 id="los-logs-no-aparecen">Los logs no aparecen</h3>
<p><strong>Soluci√≥n</strong>: Espera 10-15 segundos y refresca la p√°gina. CloudWatch tiene un ligero delay.</p>
<h3 id="respuesta-vacia-o-incorrecta">Respuesta vac√≠a o incorrecta</h3>
<p><strong>Soluci√≥n</strong>: Verifica que usaste <code>JSON.stringify()</code> en el body.</p>
<hr />
<p><strong>Siguiente</strong>: <a href="./02-dynamodb-table.html">Iteraci√≥n 2 - A√±adir DynamoDB</a></p>
        </div>
    </div>

    <!-- JavaScript for student prefix management -->
    <script src="../scripts/student-prefix.js"></script>
    <!-- JavaScript for sidebar navigation -->
    <script src="../scripts/sidebar-nav.js"></script>
</body>
</html>